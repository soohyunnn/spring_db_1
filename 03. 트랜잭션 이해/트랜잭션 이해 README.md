# íŠ¸ëœì­ì…˜ ì´í•´

## íŠ¸ëœì­ì…˜ - ê°œë… ì´í•´

ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ë‹¨í›ˆíˆ íŒŒì¼ì— ì €ì¥í•´ë„ ë˜ëŠ”ë°, ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?

ì—¬ëŸ¬ê°€ì§€ ì´ìœ ê°€ ìˆì§€ë§Œ, ê°€ì¥ ëŒ€í‘œì ì¸ ì´ìœ ëŠ” ë°”ë¡œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” íŠ¸ëœì­ì…˜ì´ë¼ëŠ” ê°œë…ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

íŠ¸ëœì­ì…˜ì„ ì´ë¦„ ê·¸ëŒ€ë¡œ ë²ˆì—­í•˜ë©´ ê±°ë˜ë¼ëŠ” ëœ»ì´ë‹¤. ì´ê²ƒì„ ì‰½ê²Œ í’€ì–´ì„œ ì´ì•¼ê¸°í•˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ íŠ¸ëœì­ì…˜ì€ í•˜ë‚˜ì˜ ê±°ë˜ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ ë³´ì¥í•´ì£¼ëŠ” ê²ƒì„ ëœ»í•œë‹¤. ê·¸ëŸ°ë° í•˜ë‚˜ì˜ ê±°ë˜ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë ¤ë©´ ìƒê°ë³´ë‹¤ ê³ ë ¤í•´ì•¼ í•  ì ì´ ë§ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ Aì˜ 5000ì›ì„ Bì—ê²Œ ê³„ì¢Œì´ì²´í•œë‹¤ê³  ìƒê°í•´ë³´ì. Aì˜ ì”ê³ ë¥¼ 5000ì› ê°ì†Œí•˜ê³ , Bì˜ ì”ê³ ë¥¼ 5000ì› ì¦ê°€í•´ì•¼í•œë‹¤.

**5000ì›ì˜ ê³„ì¢Œì´ì²´**

1. Aì˜ ì”ê³ ë¥¼ 5000ì› ê°ì†Œ
2. Bì˜ ì”ê³ ë¥¼ 5000ì› ì¦ê°€

ê³„ì¢Œì´ì²´ë¼ëŠ” ê±°ë˜ëŠ” ì´ë ‡ê²Œ 2ê°€ì§€ ì‘ì—…ì´ í•©ì³ì ¸ì„œ í•˜ë‚˜ì˜ ì‘ì—…ì²˜ëŸ¼ ë™ì‘í•´ì•¼ í•œë‹¤. ë§Œì•½ 1ë²ˆì€ ì„±ê³µí–ˆëŠ”ë° 2ë²ˆì—ì„œ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ê³„ì¡°ì´ì²´ëŠ” ì‹¤íŒ¨í•˜ê³ , Aì˜ ì”ê³ ë§Œ 5000ì› ê°ì†Œí•˜ëŠ” ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ 1, 2 ë‘˜ë‹¤ í•¨ê»˜ ì„±ê³µí•´ì•¼ ì €ì¥í•˜ê³ , ì¤‘ê°„ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ê±°ë˜ ì „ì˜ ìƒíƒœë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆë‹¤. ë§Œì•½ 1ë²ˆì€ ì„±ê³µí–ˆëŠ”ë° 2ë²ˆì—ì„œ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í•˜ê³ , ê±°ë˜ ì „ì˜ ìƒíƒœë¡œ ì™„ì „íˆ ëŒì•„ê°ˆ ìˆ˜ ìˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ Aì˜ ì”ê³ ê°€ ê°ì†Œí•˜ì§€ ì•ŠëŠ”ë‹¤.

ëª¨ë“  ì‘ì—…ì´ ì„±ê³µí•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì •ìƒ ë°˜ì˜í•˜ëŠ” ê²ƒì„ ì»¤ë°‹(`Commit`)ì´ë¼ í•˜ê³ , ì‘ì—… ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•´ì„œ ê±°ë˜ ì´ì „ìœ¼ë¡œ ë˜ëŒë¦¬ëŠ” ê²ƒì„ ë¡¤ë°±(`Rollback`)ì´ë¼ í•œë‹¤.

### íŠ¸ëœì­ì…˜ ACID

íŠ¸ëœì­ì…˜ì€ ACID([`http://en.wikipedia.org/wiki/ACID`](http://en.wikipedia.org/wiki/ACID) )ë¼ í•˜ëŠ” ì›ìì„±(Atomicity), ì¼ê´€ì„±(Consistency), ê²©ë¦¬ì„±(Isolation), ì§€ì†ì„±(Durability)ì„ ë³´ì¥í•´ì•¼ í•œë‹¤.

- **ì›ìì„±** : íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•œ ì‘ì—…ë“¤ì€ ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ì¸ ê²ƒì²˜ëŸ¼ ëª¨ë‘ ì„±ê³µ í•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
- **ì¼ê´€ì„±** : ëª¨ë“  íŠ¸ëœì­ì…˜ì€ ì¼ê´€ì„± ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì •í•œ ë¬´ê²°ì„± ì œì•½ ì¡°ê±´ì„ í•­ìƒ ë§Œì¡±í•´ì•¼ í•œë‹¤.
- **ê²©ë¦¬ì„±** : ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ë“¤ì´ ì„œë¡œì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šë„ë¡ ê²©ë¦¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•´ì•¼ í•œë‹¤. ê²©ë¦¬ì„±ì€ ë™ì‹œì„±ê³¼ ê´€ë ¨ëœ ì„±ëŠ¥ ì´ìŠˆë¡œ ì¸í•´ íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€(Isolation level)ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.
- **ì§€ì†ì„±** : íŠ¸ëœì­ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ëë‚´ë©´ ê·¸ ê²°ê³¼ê°€ í•­ìƒ ê¸°ë¡ë˜ì–´ì•¼ í•œë‹¤. ì¤‘ê°„ì— ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ ë“±ì„ ì‚¬ìš©í•´ì„œ ì„±ê³µí•œ íŠ¸ëœì­ì…˜ ë‚´ìš©ì„ ë³µêµ¬í•´ì•¼ í•œë‹¤.

íŠ¸ëœì­ì…˜ì€ ì›ìì„±, ì¼ê´€ì„±, ì§€ì†ì„±ì„ ë³´ì¥í•œë‹¤. ë¬¸ì œëŠ” ê²©ë¦¬ì„±ì¸ë° íŠ¸ëœì­ì…˜ ê°„ì— ê²©ë¦¬ì„±ì„ ì™„ë²½íˆ ë³´ì¥í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ì„ ê±°ì˜ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë§¤ìš° ë‚˜ë¹ ì§„ë‹¤. ì´ëŸ° ë¬¸ì œë¡œ ì¸í•´ ANSI í‘œì¤€ì€ íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì„ 4ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ì •ì˜í–ˆë‹¤.

### íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ - Isolation level

- READ INCOMMITED(ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°)
- READ COMMITTED(ì»¤ë°‹ëœ ì½ê¸°)
- REPEATABLE READ(ë°˜ë³µ ê°€ëŠ¥í•œ ì½ê¸°)
- SERIALIZABLE(ì§ë ¬í™” ê°€ëŠ¥)

> ğŸ’¡Â ì°¸ê³ 
ì—¬ê¸°ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•˜ëŠ” READ COMMITTED(ì»¤ë°‹ëœ ì½ê¸°) íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•œë‹¤.
íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ìì²´ì— ê´€í•œ ë¶€ë¶„ì´ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë©”ë‰´ì–¼ì´ë‚˜, JPAì±… 16.1 íŠ¸ëœì­ì…˜ê³¼ ë½ì„ ì°¸ê³ í•˜ì.
> 

## ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°ì™€ DB ì„¸ì…˜

íŠ¸ëœì­ì…˜ì„ ë” ìì„¸íˆ ì´í•´í•˜ê¸° ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ ì—°ê²° êµ¬ì¡°ì™€ DB ì„¸ì…˜ì— ëŒ€í•´ ì•Œì•„ë³´ì.

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°1

![Untitled](https://github.com/soohyunnn/spring_db_1/assets/58289675/7350a735-c052-49c3-8940-2449ab8a9924)

- ì‚¬ìš©ìëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„(WAS)ë‚˜ DB ì ‘ê·¼ íˆ´ ê°™ì€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ì—°ê²°ì„ ìš”ì²­í•˜ê³  ì»¤ë„¥ì…˜ì„ ë§ºê²Œ ëœë‹¤. ì´ë•Œ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ëŠ” ë‚´ë¶€ì— ì„¸ì…˜ì´ë¼ëŠ” ê²ƒì„ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  ì•ìœ¼ë¡œ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ í†µí•œ ëª¨ë“  ìš”ì²­ì€ ì´ ì„¸ì…˜ì„ í†µí•´ì„œ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.
- ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ ê°œë°œìê°€ í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ SQLì„ ì „ë‹¬í•˜ë©´ í˜„ì¬ ì»¤ë„¥ì…˜ì— ì—°ê²°ëœ ì„¸ì…˜ì´ SQLì„ ì‹¤í–‰í•œë‹¤.
- ì„¸ì…˜ì€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , ì»¤ë‹› ë˜ëŠ” ë¡¤ë°±ì„ í†µí•´ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤. ê·¸ë¦¬ê³  ì´í›„ì— ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆë‹¤.
- ì‚¬ìš©ìê°€ ì»¤ë„¥ì…˜ì„ ë‹«ê±°ë‚˜, ë˜ëŠ” DBA(DB ê´€ë¦¬ì)ê°€ ì„¸ì…˜ì„ ê°•ì œë¡œ ì¢…ë£Œí•˜ë©´ ì„¸ì…˜ì€ ì¢…ë£Œëœë‹¤.

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°2

![Untitled 1](https://github.com/soohyunnn/spring_db_1/assets/58289675/bb7b3abe-7d7b-4575-8848-57755b8ebefa)

- ì»¤ë„¥ì…˜ í’€ì´ 10ê°œì˜ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë©´, ì„¸ì…˜ë„ 10ê°œ ë§Œë“¤ì–´ì§„ë‹¤.

## íŠ¸ëœì­ì…˜ - DB ì˜ˆì œ1 - ê°œë… ì´í•´

ì—¬ê¸°ì„œ ì„¤ëª…í•˜ëŠ” ë‚´ìš©ì€ íŠ¸ëœì¬ì…˜ ê°œë…ì˜ ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ ì˜ˆì‹œë¡œ ì„¤ëª…í•˜ëŠ” ê²ƒì´ë‹¤. êµ¬ì²´ì ì¸ ì‹¤ì œ êµ¬í˜„ ë°©ì‹ì€ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.

**íŠ¸ëœì­ì…˜ ì‚¬ìš©ë²•**

- ë°ì´í„° ë³€ê²½ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ê·¸ ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ë ¤ë©´ ì»¤ë°‹ ëª…ë ¹ì–´ì¸ commitì„ í˜¸ì¶œí•˜ê³ , ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë©´ ë¡¤ë°± ëª…ë ¹ì–´ì¸ rollbackì„ í˜¸ì¶œí•˜ë©´ ëœë‹¤.
- ì»¤ë°‹ì„ í˜¸ì¶œí•˜ê¸° ì „ê¹Œì§€ëŠ” ì„ì‹œë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œ ì„¸ì…˜(ì‚¬ìš©ì)ì—ê²Œë§Œ ë³€ê²½ ë°ì´í„°ê°€ ë³´ì´ê³  ë‹¤ë¥¸ ì„¸ì…˜(ì‚¬ìš©ì)ì—ê²ŒëŠ” ë³€ê²½ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.
- ë“±ë¡, ìˆ˜ì •, ì‚­ì œ ëª¨ë‘ ê°™ì€ ì›ë¦¬ë¡œ ë™ì‘í•œë‹¤. ì•ìœ¼ë¡œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œë¥¼ ê°„ë‹¨íˆ ë³€ê²½ì´ë¼ëŠ” ë‹¨ì–´ë¡œ í‘œí˜„í•œë‹¤.

### ê¸°ë³¸ ë°ì´í„°

![Untitled 2](https://github.com/soohyunnn/spring_db_1/assets/58289675/ae8f5c96-4b3a-4b6f-b188-6cacf8b5548a)

- ì„¸ì…˜1, ì„¸ì…˜2 ë‘˜ë‹¤ ê°€ìš´ë° ìˆëŠ” ê¸°ë³¸ í…Œì´ë¸”ì„ ì¡°íšŒí•˜ë©´ í•´ë‹¹ ë°ì´í„°ê°€ ê·¸ëŒ€ë¡œ ì¡°íšŒëœë‹¤.

### ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€

![Untitled 3](https://github.com/soohyunnn/spring_db_1/assets/58289675/c6338773-28c7-44a0-9568-0fc6be80adc7)

- ì„¸ì…˜1ì€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ì‹ ê·œ íšŒì›1, ì‹ ê·œ íšŒì›2ë¥¼ DBì— ì¶”ê°€í–ˆë‹¤. ì•„ì§ ì»¤ë°‹ì€ í•˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.
- ìƒˆë¡œìš´ ë°ì´í„°ëŠ” ì„ì‹œ ìƒíƒœë¡œ ì €ì¥ëœë‹¤.
- ì„¸ì…˜1ì€ `select` ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ë³¸ì¸ì´ ì…ë ¥í•œ ì‹ ê·œ íšŒì›1, ì‹ ê·œ íšŒì›2ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜2ëŠ” `select` ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ë„ ì‹ ê·œ íšŒì›ë“¤ì„ ì¡°íšŒí•  ìˆ˜ ì—†ë‹¤. ì™œëƒí•˜ë©´ ì„¸ì…˜1ì´ ì•„ì§ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.

**ì»¤ë°‹í•˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ê³³ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆìœ¼ë©´ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí• ê¹Œ?**

- ì˜ˆë¥¼ ë“¤ì–´ì„œ ì»¤ë°‹í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ê°€ ë³´ì¸ë‹¤ë©´, ì„¸ì…˜2ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí–ˆì„ ë•Œ ì‹ ê·œ íšŒì›1, 2ê°€ ë³´ì¼ ê²ƒì´ë‹¤. ë”°ë¼ì„œ ì‹ ê·œ íšŒì›1, ì‹ ê·œ íšŒì›2ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì–´ë–¤ ë¡œì§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë° ì„¸ì…˜1ì´ ë¡¤ë°±ì„ ìˆ˜í–‰í•˜ë©´ ì‹ ê·œ íšŒì›1, ì‹ ê·œ íšŒì›2ì˜ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ê²Œ ëœë‹¤. ë”°ë¼ì„œ ë°ì´í„° ì •í•©ì„±ì— í° ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
- ì„¸ì…˜2ì—ì„œ ì„¸ì…˜1ì´ ì•„ì§ ì»¤ë°‹í•˜ì§€ ì•Šì€ ë³€ê²½ ë°ì´í„°ê°€ ë³´ì¸ë‹¤ë©´, ì„¸ì…˜1ì´ ë¡¤ë°± í–ˆì„ ë•Œ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì»¤ë°‹ ì „ì˜ ë°ì´í„°ëŠ” ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.

### ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ í›„ commit

![Untitled 4](https://github.com/soohyunnn/spring_db_1/assets/58289675/e4defff7-7b59-489b-a962-12eb2335fb39)

- ì„¸ì…˜1ì´ ì‹ ê·œ ë°ì´í„°ë¥¼ ì¶”ê°€í•œ í›„ì— `commit`ì„ í˜¸ì¶œí–ˆë‹¤.
- `commit`ìœ¼ë¡œ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ëœë‹¤. ë°ì´í„°ì˜ ìƒíƒœë„ ì„ì‹œ â†’ ì™„ë£Œë¡œ ë³€ê²½ë˜ì—ˆë‹¤.
- ì´ì œ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œë„ íšŒì› í…Œì´ë¸”ì„ ì¡°íšŒí•˜ë©´ ì‹ ê·œ íšŒì›ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ í›„ rollback

![Untitled 5](https://github.com/soohyunnn/spring_db_1/assets/58289675/7201253b-c424-4e6c-b38a-ecd67a589fbd)

- ì„¸ì…˜1ì´ ì‹ ê·œ ë°ì´í„°ë¥¼ ì¶”ê°€í•œ í›„ì— `commit` ëŒ€ì‹ ì— `rollback`ì„ í˜¸ì¶œí–ˆë‹¤.
- ì„¸ì…˜1ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•œ ëª¨ë“  ë°ì´í„°ê°€ ì²˜ìŒ ìƒíƒœë¡œ ë³µêµ¬ëœë‹¤.
- ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•œ ë°ì´í„°ë„ `rollback`ì„ í˜¸ì¶œí•˜ë©´ ëª¨ë‘ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ì§ì „ì˜ ìƒíƒœë¡œ ë³µêµ¬ëœë‹¤.

## íŠ¸ëœì­ì…˜ - DB ì˜ˆì œ2 - ìë™ ì»¤ë°‹, ìˆ˜ë™ ì»¤ë°‹

ì˜ˆì œì— ì‚¬ìš©ë˜ëŠ” ìŠ¤í‚¤ë§ˆëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```sql
drop table member if exists;
create table member (
    member_id varchar(10),
    money integer not null default 0,
    primary key (member_id)
);
```

### ìë™ ì»¤ë°‹

íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € ìë™ ì»¤ë°‹ê³¼ ìˆ˜ë™ ì»¤ë°‹ì„ ì´í•´í•´ì•¼ í•œë‹¤.

ìë™ ì»¤ë°‹ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ê°ê°ì˜ ì¿¼ë¦¬ ì‹¤í–‰ ì§í›„ì— ìë™ìœ¼ë¡œ ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤. ë”°ë¼ì„œ ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” í¸ë¦¬í•¨ì´ ìˆë‹¤. í•˜ì§€ë§Œ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜í•˜ë‚˜ ì‹¤í–‰í•  ë•Œ ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì»¤ë°‹ì´ ë˜ì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì›í•˜ëŠ” íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

**ìë™ ì»¤ë°‹ ì„¤ì •**

```sql
set autocommit true; //ìë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì •
insert into member(member_id, money) values ('data1',10000); //ìë™ ì»¤ë°‹ 
insert into member(member_id, money) values ('data2',10000); //ìë™ ì»¤ë°‹
```

ë”°ë¼ì„œ commit, rollbackì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ì„œ íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ìˆ˜í–‰í•˜ë ¤ë©´ ìë™ ì»¤ë°‹ì„ ë„ê³  ìˆ˜ë™ ì»¤ë°‹ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

**ìˆ˜ë™ ì»¤ë°‹ ì„¤ì •**

```sql
set autocommit false; //ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì •
insert into member(member_id, money) values ('data3',10000);
insert into member(member_id, money) values ('data4',10000); 
commit; //ìˆ˜ë™ ì»¤ë°‹
```

ë³´í†µ ìë™ ì»¤ë°‹ ëª¨ë“œê°€ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •ëœ ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì—, ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

ìˆ˜ë™ ì»¤ë°‹ ì„¤ì •ì„ í•˜ë©´ ì´í›„ì— ê¼­ commit, rollbackì„ í˜¸ì¶œí•´ì•¼ í•œë‹¤.

ì°¸ê³ ë¡œ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë‚˜ ìë™ ì»¤ë°‹ ëª¨ë“œëŠ” í•œë²ˆ ì„¤ì •í•˜ë©´ í•´ë‹¹ ì„¸ì…˜ì—ì„œëŠ” ê³„ì† ìœ ì§€ëœë‹¤. ì¤‘ê°„ì— ë³€ê²½í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ë‹¤.

## íŠ¸ëœì­ì…˜ - DB ì˜ˆì œ3 - íŠ¸ëœì­ì…˜ ì‹¤ìŠµ

### 1. ê¸°ë³¸ ë°ì´í„° ì…ë ¥

H2 ë°ì´í„°ë² ì´ìŠ¤ ì›¹ ì½˜ì†” ì°½ì„ 2ê°œë¥¼ ì—´ì–´ë‘¬ì•¼ í•œë‹¤.

> âš ï¸Â ì£¼ì˜
H2 ë°ì´í„°ë² ì´ìŠ¤ ì›¹ ì½˜ì†” ì°½ì„ 2ê°œ ì—´ë•Œ ê¸°ë³¸ URLì„ ë³µì‚¬í•˜ë©´ ì•ˆëœë‹¤. ê¼­ http://localhost:8082ë¥¼ ì§ì ‘ ì…ë ¥í•´ì„œ ì™„ì „íˆ ìƒˆë¡œìš´ ì„¸ì…˜ì—ì„œ ì—°ê²°í•˜ë„ë¡ í•´ì•¼í•œë‹¤. URLì„ ë³µì‚¬í•˜ë©´ ê°™ì€ ì„¸ì…˜(jsessionId)ì—ì„œ ì‹¤í–‰ë˜ì–´ì„œ ì›í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
> 

ğŸ‘‰Â http://localhost:8082ì— ì ‘ê·¼í–ˆì„ ë•Œ ë‹¤ìŒê³¼ ê°™ì´ jseesionid ê°’ì´ ì„œë¡œ ë‹¬ë¼ì•¼ í•œë‹¤.

jseesionid ê°’ì´ ê°™ìœ¼ë©´ ê°™ì€ ì„¸ì…˜ì— ì ‘ê·¼í•˜ê²Œ ëœë‹¤.

- 1ë²ˆ URL : [http://localhost:8082/login.do](http://localhost:8082/login.do)?jsessionid=744cb5cbdfeab7d972e93d08d731b005
- 2ë²ˆ URL : [http://localhost:8082/login.do](http://localhost:8082/login.do)?jsessionid=5e297b3dbeaa2383acc1109942bd2a41

ë¨¼ì € ê¸°ë³¸ í…Œì´ë¸”ì„ ë‹¤ìŒê³¼ ê°™ì´ ë§ì¶”ì–´ë‘ì

ê¸°ë³¸ ë°ì´í„°

![Untitled 6](https://github.com/soohyunnn/spring_db_1/assets/58289675/3503960a-323a-49bd-8c9d-435e7855a58d)

**ë°ì´í„° ì´ˆê¸°í™” SQL**

```sql
//ë°ì´í„° ì´ˆê¸°í™”
set autocommit true;
delete from member;
insert into member(member_id, money) values ('oldId',10000);
```

ìë™ ì»¤ë°‹ ëª¨ë“œë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ë³„ë„ë¡œ ì»¤ë°‹ì„ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

> âš ï¸Â ì£¼ì˜
ë§Œì•½ ì˜ ì§„í–‰ë˜ì§€ ì•Šìœ¼ë©´ ì´ì „ì— ì‹¤í–‰í•œ íŠ¹ì • ì„¸ì…˜ì—ì„œ ë½ì„ ê±¸ê³  ìˆì„ ìˆ˜ ìˆë‹¤. H2 ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ë¥¼ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ì.
> 

ì´ë ‡ê²Œ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³ , ì„¸ì…˜1, ì„¸ì…˜2ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì.

```sql
select * from member;
```

- ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ì™€ ë¹„êµí•˜ì. ì°¸ê³ ë¡œ ì´ë¯¸ì§€ì˜ name í•„ë“œëŠ” ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ ê·¸ë¦° ê²ƒì´ê³  ì‹¤ì œë¡œëŠ” ì—†ë‹¤.

### 2. ì‹ ê·œ ë°ì´í„° ì¶”ê°€ - ì»¤ë°‹ ì „

ì„¸ì…˜1ì—ì„œ ì‹ ê·œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ë³´ì. ì•„ì§ ì»¤ë°‹ì€ í•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.

**ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€**

![Untitled 7](https://github.com/soohyunnn/spring_db_1/assets/58289675/c11a6e9d-1ca4-4531-9dc1-e40cabf4f35e)

**ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ SQL**

```sql
//íŠ¸ëœì­ì…˜ ì‹œì‘
set autocommit false; //ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ
insert into member(member_id, money) values ('newId1',10000); 
insert into member(member_id, money) values ('newId2',10000);
```

ì„¸ì…˜1, ì„¸ì…˜2ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì.

```sql
select * from member;
```

ğŸ‘‰Â ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ì™€ ë¹„êµí•´ë³´ë©´, ì•„ì§ ì„¸ì…˜1ì´ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ì„¸ì…˜1ì—ì„œëŠ” ì…ë ¥í•œ ë°ì´í„°ê°€ ë³´ì´ì§€ë§Œ, ì„¸ì…˜2ì—ì„œëŠ” ì…ë ¥í•œ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### 3. ì»¤ë°‹ - commit

ì„¸ì…˜1ì—ì„œ ì‹ ê·œ ë°ì´í„°ë¥¼ ì…ë ¥í–ˆëŠ”ë°, ì•„ì§ ì»¤ë°‹ì€ í•˜ì§€ ì•Šì•˜ë‹¤. 

ì´ì œ ì»¤ë°‹ì„ í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ê²°ê³¼ë¥¼ ë°˜ì˜í•´ë³´ì.

**ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ í›„ commit**

![Untitled 8](https://github.com/soohyunnn/spring_db_1/assets/58289675/d72195ed-b2fa-4f9f-8692-c763a3307130)

ì„¸ì…˜1ì—ì„œ ì»¤ë°‹ì„ í˜¸ì¶œí•´ë³´ì.

```sql
commit; //ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜
```

ì„¸ì…˜1, ì„¸ì…˜2ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì.

```sql
select * from member;
```

ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ì™€ ë¹„êµí•´ë³´ì. ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í–ˆê¸° ë•Œë¬¸ì— ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤ì œ ë°ì´í„°ê°€ ë°˜ì˜ëœë‹¤. ì»¤ë°‹ ì´í›„ì—ëŠ” ëª¨ë“  ì„¸ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

### ë¡¤ë°± - rollback

**ê¸°ë³¸ ë°ì´í„°**

![Untitled 9](https://github.com/soohyunnn/spring_db_1/assets/58289675/5f9eded0-d806-4799-b28c-c6aa12844f97)

ì˜ˆì œë¥¼ ì²˜ìŒìœ¼ë¡œ ëŒë¦¬ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•œë‹¤.

```sql
//ë°ì´í„° ì´ˆê¸°í™”
set autocommit true;
delete from member;
insert into member(member_id, money) values ('oldId',10000);
```

**ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ í›„**

![Untitled 10](https://github.com/soohyunnn/spring_db_1/assets/58289675/4e101d8b-8f41-488b-b80d-2648e068498b)

ì„¸ì…˜1ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘ ìƒíƒœë¡œ ë§Œë“  ë‹¤ìŒì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì.

```sql
//íŠ¸ëœì­ì…˜ ì‹œì‘
set autocommit false; //ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ
insert into member(member_id, money) values ('newId1',10000); 
insert into member(member_id, money) values ('newId2',10000);
```

ì„¸ì…˜1, ì„¸ì…˜2ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì.

```sql
select * from member;
```

ğŸ‘‰Â ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ì™€ ë¹„êµí•´ë³´ë©´ ì•„ì§ ì„¸ì…˜1ì´ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ì„¸ì…˜1ì—ì„œëŠ” ì…ë ¥í•œ ë°ì´í„°ê°€ ë³´ì´ì§€ë§Œ, ì„¸ì…˜2ì—ì„œëŠ” ì…ë ¥í•œ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ì„¸ì…˜1 ì‹ ê·œ ë°ì´í„° ì¶”ê°€ í›„ rollback**

![Untitled 11](https://github.com/soohyunnn/spring_db_1/assets/58289675/10a513c0-824e-453e-9d9f-23e7c8c5482e)

ì„¸ì…˜1ì—ì„œ ë¡¤ë°±ì„ í˜¸ì¶œí•´ë³´ì.

```sql
rollback;  //ë¡¤ë°±ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤.
```

ì„¸ì…˜1, ì„¸ì…˜2ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì.

```sql
select * from member;
```

ğŸ‘‰Â ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ì™€ ë¹„êµí•´ë³´ë©´, ë¡¤ë°±ìœ¼ë¡œ ë°ì´í„°ê°€ DBì— ë°˜ì˜ë˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## íŠ¸ëœì­ì…˜ - DB ì˜ˆì œ4 - ê³„ì¢Œì´ì²´

ì´ë²ˆì—ëŠ” ì•„ë˜ 3ê°€ì§€ ìƒí™©ì— ëŒ€í•´ ì•Œì•„ë³¼ ê²ƒì´ë‹¤.

- ê³„ì¢Œì´ì²´ ì •ìƒ
- ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ì»¤ë°‹
- ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ë¡¤ë°±

### ê³„ì¢Œì´ì²´ ì •ìƒ

ê³„ì¢Œì´ì²´ê°€ ë°œìƒí•˜ëŠ” ì •ìƒ íë¦„ì„ ì•Œì•„ë³´ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥**

![Untitled 12](https://github.com/soohyunnn/spring_db_1/assets/58289675/17f0d806-4f25-46c7-a37b-a245d86a82b0)

ë¨¼ì € ë‹¤ìŒ SQLë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì„¤ì •í•˜ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥ - SQL**

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);
```

ë‹¤ìŒ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì¤€ë¹„í–ˆë‹¤.

- `memberA` 10000ì›
- `memberB` 10000ì›

ê³„ì¢Œì´ì²´ë¥¼ ì‹¤í–‰í•´ë³´ì.

**ê³„ì¢Œì´ì²´ ì‹¤í–‰**

![Untitled 13](https://github.com/soohyunnn/spring_db_1/assets/58289675/6118b47c-46ff-4c70-b142-681f4b884687)

- `memberA`ì˜ ëˆì„ `memberB`ì—ê²Œ 2000ì› ê³„ì¢Œì´ì²´í•˜ëŠ” íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•´ë³´ì. ë‹¤ìŒê³¼ ê°™ì´ 2ë²ˆì˜ `update` ì¿¼ë¦¬ê°€ ìˆ˜í–‰ë˜ì–´ì•¼ í•œë‹¤.
- `set autocommit false`ë¡œ ì„¤ì •í•œë‹¤.
- ì•„ì§ ì»¤ë°‹í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ë‹¤ë¥¸ ì„¸ì…˜ì—ëŠ” ê¸°ì¡´ ë°ì´í„°ê°€ ì¡°íšŒëœë‹¤.

**ê³„ì¢Œì´ì²´ ì‹¤í–‰ SQL - ì„±ê³µ**

```sql
set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA';
update member set money=10000 + 2000 where member_id = 'memberB';
```

**ì»¤ë°‹**

![Untitled 14](https://github.com/soohyunnn/spring_db_1/assets/58289675/67230700-3333-43da-a275-7e38e1fda8b4)

- `commit` ëª…ë ¥ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ê²°ê³¼ê°€ ë°˜ì˜ëœë‹¤.
- ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œë„ `memberA`ì˜ ê¸‰ì•¡ì´ 8000ì›ìœ¼ë¡œ ì¤„ì–´ë“¤ê³ , `memberB`ì˜ ê¸ˆì•¡ì´ 12000ì›ìœ¼ë¡œ ì¦ê°€í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ì„¸ì…˜1 ì»¤ë°‹**

```sql
commit;
```

**í™•ì¸ ì¿¼ë¦¬**

```sql
select * from member;
```

### ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ì»¤ë°‹

ì´ë²ˆì—ëŠ” ê³„ì¢Œì´ì²´ ë„ì¤‘ì— ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ìƒí™©ì„ ì•Œì•„ë³´ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥**

![Untitled 15](https://github.com/soohyunnn/spring_db_1/assets/58289675/84fd4f77-fa07-4e95-be0e-7f485219a911)

ë¨¼ì € ë‹¤ìŒ SQLë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì„¤ì •í•˜ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥ - SQL**

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);
```

**ê³„ì¢Œì´ì²´ ì‹¤í–‰**

![Untitled 16](https://github.com/soohyunnn/spring_db_1/assets/58289675/820bf0ab-4de3-49e3-8291-b80e892354b4)

- ê³„ì¢Œì´ì²´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë„ì¤‘ì— SQLì— ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ê·¸ë˜ì„œ `memberA`ì˜ ëˆì„ 2000ì› ì¤„ì´ëŠ” ê²ƒì—ëŠ” ì„±ê³µí–ˆì§€ë§Œ, `memberB`ì˜ ëˆì„ 2000ì› ì¦ê°€ì‹œí‚¤ëŠ” ê²ƒì— ì‹¤íŒ¨í•œë‹¤.
- ë‘ ë²ˆì§¸ SQLì€ `member_iddd`ë¼ëŠ” í•„ë“œì— ì˜¤íƒ€ê°€ ìˆë‹¤. ë‘ ë²ˆì§¸ update ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ SQL ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ê³„ì¢Œì´ì²´ ì‹¤í–‰ SQL - ì˜¤ë¥˜**

```sql
set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA'; //ì„±ê³µ 
update member set money=10000 + 2000 where member_iddd = 'memberB'; //ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ
```

**ë‘ ë²ˆì§¸ SQL ì‹¤í–‰ì‹œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€**

```sql
Column "MEMBER_IDDD" not found; SQL statement:
update member set money=10000 + 2000 where member_iddd = 'memberB' [42122-200] 42S22/42122
```

- ì—¬ê¸°ì„œ ë¬¸ì œëŠ” `memberA`ì˜ ëˆì€ 2000ì› ì¤„ì–´ë“¤ì—ˆì§€ë§Œ, `memberB`ì˜ ëˆì€ 2000ì› ì¦ê°€í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì ì´ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í•˜ê³  `memberA`ì˜ ëˆë§Œ 2000ì› ì¤„ì–´ë“  ìƒí™©ì´ë‹¤.

**ê°•ì œ ì»¤ë°‹**

![Untitled 17](https://github.com/soohyunnn/spring_db_1/assets/58289675/7beb875b-d2ca-449c-98da-e6bcd1a4afc6)

ë§Œì•½ ì´ ìƒí™©ì—ì„œ ê°•ì œë¡œ `commit`ì„ í˜¸ì¶œí•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í•˜ê³  `memberA`ì˜ ëˆë§Œ 2000ì› ì¤„ì–´ë“œëŠ” ì•„ì£¼ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

**ì„¸ì…˜1 ì»¤ë°‹**

```sql
commit;
```

**í™•ì¸ ì¿¼ë¦¬**

```sql
select * from member;
```

ì´ë ‡ê²Œ ì¤‘ê°„ì— ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•ŒëŠ” ì»¤ë°‹ì„ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤. ë¡¤ë°±ì„ í˜¸ì¶œí•´ì„œ ë°ì´í„°ë¥¼ íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ì›ë³µí•´ì•¼ í•œë‹¤.

### ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ë¡¤ë°±

ì¤‘ê°„ì— ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë¡¤ë°±ì„ í˜¸ì¶œí•´ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì›ë³µí•´ë³´ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥**

![Untitled 18](https://github.com/soohyunnn/spring_db_1/assets/58289675/1cf8be9c-7269-461d-8bed-0ed64285c287)

ë¨¼ì € ë‹¤ìŒ SQLë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì„¤ì •í•˜ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥ - SQL**

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);
```

**ê³„ì¢Œì´ì²´ ì‹¤í–‰**

![Untitled 19](https://github.com/soohyunnn/spring_db_1/assets/58289675/1896a58e-a3b8-4a0e-a712-297ff774ac34)

ê³„ì¢Œì´ì²´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë„ì¤‘ì— SQLì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ê·¸ë˜ì„œ `memberA`ì˜ ëˆì„ 2000ì› ì¤„ì´ëŠ” ê²ƒì—ëŠ” ì„±ê³µí–ˆì§€ë§Œ, `memberB`ì˜ ëˆì„ 2000ì› ì¦ê°€ì‹œí‚¤ëŠ” ê²ƒì— ì‹¤íŒ¨í•œë‹¤. ë‘ ë²ˆì§¸ update ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ SQL ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë”°.

**ê³„ì¢Œì´ì²´ ì‹¤í–‰ SQL - ì˜¤ë¥˜**

```sql
set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA'; //ì„±ê³µ update member set money=10000 + 2000 where member_iddd = 'memberB'; //ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ
```

**ë‘ ë²ˆì§¸ SQL ì‹¤í–‰ì‹œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€**

```sql
Column "MEMBER_IDDD" not found; SQL statement:
update member set money=10000 + 2000 where member_iddd = 'memberB' [42122-200]
42S22/42122
```

- ì—¬ê¸°ì„œ ë¬¸ì œëŠ” `memberA`ì˜ ëˆì€ 2000ì› ì¤„ì–´ë“¤ì—ˆì§€ë§Œ, `memberB`ì˜ ëˆì€ 2000ì› ì¦ê°€í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì ì´ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í•˜ê³  `memberA`ì˜ ëˆë§Œ 2000ì› ì¤„ì–´ë“  ìƒí™©ì´ë‹¤.

**ë¡¤ë°±**

![Untitled 20](https://github.com/soohyunnn/spring_db_1/assets/58289675/e3d43d8a-aa71-4757-b0e0-fc73698de3ef)

ì´ëŸ´ ë•ŒëŠ” ë¡¤ë°±ì„ í˜¸ì¶œí•´ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ì „ ë‹¨ê³„ë¡œ ë°ì´í„°ë¥¼ ë³µêµ¬í•´ì•¼ í•œë‹¤.

ë¡¤ë°±ì„ ì‚¬ìš©í•œ ë•ë¶„ì— ê³„ì¢Œì´ì²´ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ ìƒíƒœë¡œ ëŒì•„ì™”ë‹¤. `memberA`ì˜ ëˆë„ ì´ì „ ìƒíƒœì¸ 10000ì›ìœ¼ë¡œ ëŒì•„ì˜¤ê³ , `memberB`ì˜ ëˆë„ `10000`ì›ìœ¼ë¡œ ìœ ì§€ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ì„¸ì…˜1 - ë¡¤ë°±**

```sql
rollback;
```

**í™•ì¸ ì¿¼ë¦¬**

```sql
select * from member;
```

**ì •ë¦¬**

- ì›ìì„± : íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•œ ì‘ì—…ë“¤ì€ ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ì¸ ê²ƒì²˜ëŸ¼ ëª¨ë‘ ì„±ê³µ í•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
    
    íŠ¸ëœì­ì…˜ì˜ ì›ìì„± ë•ë¶„ì— ì—¬ëŸ¬ SQL ëª…ë ¹ì–´ë¥¼ ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ì¸ ê²ƒ ì²˜ëŸ¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤. ì„±ê³µí•˜ë©´ í•œë²ˆì— ë°˜ì˜í•˜ê³ , ì¤‘ê°„ì— ì‹¤íŒ¨í•´ë„ ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ì„ ë˜ëŒë¦¬ëŠ” ê²ƒ ì²˜ëŸ¼ ê°„ë‹¨íˆ ë˜ëŒë¦´ ìˆ˜ ìˆë‹¤.
    
- ì˜¤í†  ì»¤ë°‹
    
    ë§Œì•½ ì˜¤í†  ì»¤ë°‹ ëª¨ë“œë¡œ ë™ì‘í•˜ëŠ”ë°, ê³„ì¢Œì´ì²´ ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ ì‹¤í–‰í•  ë•Œ ë§ˆë‹¤ ë°”ë¡œë°”ë¡œ ì»¤ë°‹ì´ ë˜ì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì— `memberA`ì˜ ëˆë§Œ 2000ì› ì¤„ì–´ë“œëŠ” ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
    
- íŠ¸ëœì­ì…˜ ì‹œì‘
    
    ë”°ë¼ì„œ ì´ëŸ° ì¢…ë¥˜ì˜ ì‘ì—…ì€ ê¼­ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¥¼ ì‚¬ìš©í•´ì„œ ìˆ˜ë™ìœ¼ë¡œ ì»¤ë°‹, ë¡¤ë°± í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•œë‹¤. ë³´í†µ ì´ë ‡ê²Œ ìë™ ì»¤ë°‹ ëª¨ë“œì—ì„œ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì „í™˜ í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  í‘œí˜„í•œë‹¤.
    

## DB ë½ - ê°œë… ì´í•´

ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë™ì•ˆ ì•„ì§ ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ì§€ ì•Šì•˜ëŠ”ë°, ì„¸ì…˜2ì—ì„œ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê²Œ ë˜ë©´ ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ë°”ë¡œ íŠ¸ëœì­ì…˜ì˜ ì›ìì„±ì´ ê¹¨ì§€ëŠ” ê²ƒì´ë‹¤. ì—¬ê¸°ì— ë”í•´ì„œ ì„¸ì…˜1ì´ ì¤‘ê°„ì— ë¡¤ë°±ì„ í•˜ê²Œ ë˜ë©´ ì„¸ì…˜2ëŠ” ì˜ëª»ëœ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

ì´ëŸ° ë¬¸ì œë¥¼ ë°©ì§€í•˜ë ¤ë©´, ì„¸ì…˜ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë™ì•ˆì—ëŠ” ì»¤ë°‹ì´ë‚˜ ë¡¤ë°± ì „ê¹Œì§€ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ê²Œ ë§‰ì•„ì•¼ í•œë‹¤.

### ë½0

![Untitled 21](https://github.com/soohyunnn/spring_db_1/assets/58289675/7c1fb699-eb43-4025-aec7-7c592d85b9e2)

- ì„¸ì…˜1ì€ `memberA`ì˜ ê¸ˆì•¡ì„ 500ì›ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì‹¶ê³ , ì„¸ì…˜2ëŠ” ê°™ì€ `memberA`ì˜ ê¸ˆì•¡ì„ 1000ì›ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì‹¶ë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë½(Lock)ì´ë¼ëŠ” ê°œë…ì„ ì œê³µí•œë‹¤.
- ë‹¤ìŒ ì˜ˆì‹œë¥¼ í†µí•´ ë™ì‹œì— ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë¬¸ì œë¥¼ ë½ìœ¼ë¡œ ì–´ë–»ê²Œ í•´ê²°í•˜ëŠ”ì§€ ìì„¸íˆ ì•Œì•„ë³´ì.

### ë½1

![Untitled 22](https://github.com/soohyunnn/spring_db_1/assets/58289675/49f7443e-574d-42b8-b0c0-48f5f27758a5)

1. ì„¸ì…˜1ì€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.
2. ì„¸ì…˜1ì€ `memberA`ì˜ `money`ë¥¼ 500ìœ¼ë¡œ ë³€ê²½ì„ ì‹œë„í•œë‹¤. ì´ë•Œ í•´ë‹¹ ë¡œìš°ì˜ ë½ì„ ë¨¼ì € íšë“í•´ì•¼ í•œë‹¤.
    
    ë½ì´ ë‚¨ì•„ ìˆìœ¼ë¯€ë¡œ ì„¸ì…˜1ì€ ë½ì„ íšë“í•œë‹¤. (ì„¸ì…˜1ì´ ì„¸ì…˜2ë³´ë‹¤ ì¡°ê¸ˆ ë” ë¹¨ë¦¬ ìš”ì²­í–ˆë‹¤.)
    
3. ì„¸ì…˜1ì€ ë½ì„ íšë“í–ˆìœ¼ë¯€ë¡œ í•´ë‹¹ ë¡œìš°ì— update sqlì„ ìˆ˜í–‰í•œë‹¤.

### ë½2

![Untitled 23](https://github.com/soohyunnn/spring_db_1/assets/58289675/3f1b3685-11a3-4569-98fd-48144cb10375)

1. ì„¸ì…˜2ë„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.
2. ì„¸ì…˜2ë„ `memberA`ì˜ `money` ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë ¤ê³  ì‹œë„í•œë‹¤. ì´ë•Œ í•´ë‹¹ ë¡œìš°ì˜ ë½ì„ ë¨¼ì € íšë“í•´ì•¼ í•œë‹¤. ë½ì´ ì—†ìœ¼ë¯€ë¡œ ë½ì´ ëŒì•„ì˜¬ ë•Œ ê¹Œì§€ ëŒ€ê¸°í•œë‹¤.

ì°¸ê³ ë¡œ ì„¸ì…˜2ê°€ ë½ì„ ë¬´í•œì • ëŒ€ê¸°í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ë½ ëŒ€ê¸° ì‹œê°„ì„ ë„˜ì–´ê°€ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ë½ ëŒ€ê¸° ì‹œê°„ì€ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

### ë½3

![Untitled 24](https://github.com/soohyunnn/spring_db_1/assets/58289675/a5c51287-8404-4ac4-85b1-bba87dcb058d)

1. ì„¸ì…˜1ì€ ì»¤ë°‹ì„ ìˆ˜í–‰í•œë‹¤. ì»¤ë°‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë½ë„ ë°˜ë‚©í•œë‹¤.

### ë½4

![Untitled 25](https://github.com/soohyunnn/spring_db_1/assets/58289675/158f638d-9a4c-4034-bad3-91dd0a5a924b)

ë½ì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ë˜ ì„¸ì…˜2ê°€ ë½ì„ íšë“í•œë‹¤.

### ë½5

![Untitled 26](https://github.com/soohyunnn/spring_db_1/assets/58289675/e7cf6dc4-d53e-41c8-ba8c-c77829dcc9f8)

1. ì„¸ì…˜2ëŠ” update sqlì„ ìˆ˜í–‰í•œë‹¤.

### ë½6

![Untitled 27](https://github.com/soohyunnn/spring_db_1/assets/58289675/e2fbf543-6d8b-4e44-ad28-2238fd9cad57)

1. ì„¸ì…˜2ëŠ” ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ê³  íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë½ì„ ë°˜ë‚©í•œë‹¤.

## DB ë½ - ë³€ê²½

ì•ì„œ ë°°ìš´ ë‚´ìš©ì„ ì‹¤ìŠµí•´ë³´ì.

### ë½0

![Untitled 28](https://github.com/soohyunnn/spring_db_1/assets/58289675/3aca90cd-5526-48ef-88db-17a3a8ec0972)

ì‹¤ìŠµì„ ìœ„í•´ ë°ì´í„°ë¥¼ ê¸°ë³¸ ë°ì´í„°ë¡œ ì…ë ¥í•˜ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥ - SQL**

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
```

### ë³€ê²½ê³¼ ë½

### ë½1

![Untitled 29](https://github.com/soohyunnn/spring_db_1/assets/58289675/319a4130-f056-4d0d-8199-a45c83882aa9)

**ì„¸ì…˜1**

```sql
set autocommit false;
update member set money=500 where member_id = 'memberA';
```

- ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , memberAì˜ ë°ì´í„°ë¥¼ 500ì›ìœ¼ë¡œ ì—…ë°ì´íŠ¸í–ˆë‹¤. ì•„ì§ ì»¤ë°‹ì€ í•˜ì§€ ì•Šì•˜ë‹¤.
- memberA ë¡œìš°ì˜ ë½ì€ ì„¸ì…˜1ì´ ê°€ì§€ê²Œ ëœë‹¤.

### ë½2

![Untitled 30](https://github.com/soohyunnn/spring_db_1/assets/58289675/b6cd478d-351a-4da3-ae09-d044c8121bf9)

**ì„¸ì…˜2**

```sql
SET LOCK_TIMEOUT 60000;
set autocommit false;
update member set money=1000 where member_id = 'memberA';
```

- ì„¸ì…˜2ëŠ” memberAì˜ ë°ì´í„°ë¥¼ 1000ì›ìœ¼ë¡œ ìˆ˜ì •í•˜ë ¤ í•œë‹¤.
- ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•´ì„œ ì¢…ë£Œí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì•„ì§ ì„¸ì…˜1ì´ ë½ì„ ê°€ì§€ê³  ìˆë‹¤. ë”°ë¼ì„œ ì„¸ì…˜2ëŠ” ë½ì„ íšë“í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ë‹¤. ì„¸ì…˜2ëŠ” ë½ì´ ëŒì•„ì˜¬ ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤.
- SET LOCK_TIMEOUT 60000 : ë½ íšë“ ì‹œê°„ì„ 60ì´ˆë¡œ ì„¤ì •í•œë‹¤. 60ì´ˆ ì•ˆì— ë½ì„ ì–»ì§€ ëª»í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
    - ì°¸ê³ ë¡œ H2 ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ë”± 60ì´ˆì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ëŠ” ì•Šê³ , ì‹œê°„ì´ ì¡°ê¸ˆ ë” ê±¸ë¦´ ìˆ˜ ìˆë‹¤.

**ì„¸ì…˜2 ë½ íšë“**

ì„¸ì…˜1ì„ ì»¤ë°‹í•˜ë©´ ì„¸ì…˜1ì´ ì»¤ë°‹ë˜ë©´ì„œ ë½ì„ ë°˜ë‚©í•œë‹¤. ì´í›„ì— ëŒ€ê¸°í•˜ë˜ ì„¸ì…˜2ê°€ ë½ì„ íšë“í•˜ê²Œ ëœë‹¤.

ë”°ë¼ì„œ ë½ì„ íšë“í•œ ì„¸ì…˜2ì˜ ì—…ë°ì´íŠ¸ê°€ ë°˜ì˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡  ì´í›„ì— ì„¸ì…˜2ë„ ì»¤ë°‹ì„ í˜¸ì¶œí•´ì„œ ë½ì„ ë°˜ë‚©í•´ì•¼ í•œë‹¤.

### ë½3

![Untitled 31](https://github.com/soohyunnn/spring_db_1/assets/58289675/1eeac7b2-b740-44f7-8c9e-13f6596860ab)

1. ì„¸ì…˜1ì€ ì»¤ë°‹ì„ ìˆ˜í–‰í•œë‹¤. ì»¤ë°‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë½ë„ ë°˜ë‚©í•œë‹¤.

**ì„¸ì…˜1**

```sql
commit;
```

ì„¸ì…˜1ì´ ì»¤ë°‹í•˜ë©´ ì´í›„ì— ë½ì„ ë°˜ë‚©í•˜ê³  ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì´ì–´ì§„ë‹¤.

### ë½4

![Untitled 32](https://github.com/soohyunnn/spring_db_1/assets/58289675/3b42fce3-afb5-41c6-a117-ba93c5795a0f)

ë½ì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ë˜ ì„¸ì…˜2ê°€ ë½ì„ íšë“í•œë‹¤.

### ë½5

![Untitled 26](https://github.com/soohyunnn/spring_db_1/assets/58289675/2b7c57ed-a961-41fc-a886-dd9af9e5d008)

1. ì„¸ì…˜2ëŠ” update sqlì„ ìˆ˜í–‰í•œë‹¤.

### ë½6

![Untitled 27](https://github.com/soohyunnn/spring_db_1/assets/58289675/c79f0381-3c0e-48fc-9fae-b1e446506446)

1. ì„¸ì…˜2ëŠ” ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ê³  íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë½ì„ ë°˜ë‚©í•œë‹¤.

**ì„¸ì…˜2**

```sql
commit;
```

### ì„¸ì…˜2 ë½ íƒ€ì„ì•„ì›ƒ

- `SET LOCK_TIMEOUT <milliseconds>` : ë½ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì„ ì„¤ì •í•œë‹¤.
- ì˜ˆ) `SET LOCK_TIMEOUT 10000` 10ì´ˆ, ì„¸ì…˜2ì— ì„¤ì •í•˜ë©´ ì„¸ì…˜2ê°€ 10ì´ˆ ë™ì•ˆ ëŒ€ê¸°í•´ë„ ë½ì„ ì–»ì§€ ëª»í•˜ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

ìœ„ ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ê°„ì— ë½ì„ ì˜¤ëœê¸°ê°„ ëŒ€ê¸°í•˜ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ì•Œì•„ë³´ì.

10ì´ˆ ì •ë„ ê¸°ë‹¤ë¦¬ë©´ ì„¸ì…˜2ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë½ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

**ì„¸ì…˜2ì˜ ì‹¤í–‰ ê²°ê³¼**

```sql
Timeout trying to lock table {0}; SQL statement:
update member set money=10000 - 2000 where member_id = 'memberA' [50200-200]
HYT00/50200
```

ì„¸ì…˜1ì´ `memberA`ì˜ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³ , íŠ¸ëœì­ì…˜ì„ ì•„ì§ ì»¤ë°‹í•˜ì§€ ì•Šì•˜ë‹¤. ë”°ë¼ì„œ ì„¸ì…˜2ëŠ” ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•œë‹¤. ê¸°ë‹¤ë¦¬ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> âš ï¸Â ì£¼ì˜!
í…ŒìŠ¤íŠ¸ ë„ì¤‘ ë½ì´ ê¼¬ì´ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ê²½ìš° H2 ì„œë²„ë¥¼ ë‚´ë ¸ë‹¤ê°€ ì˜¬ë¦¬ë©´ ëœë‹¤.
H2 ì„œë²„ë¥¼ ë‚´ë¦°ë‹¤ëŠ”ê²ƒ `h2.sh`, `h2.bat`ë¥¼ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ëœ»í•œë‹¤.
> 

## DB ë½ - ì¡°íšŒ

**ì¼ë°˜ì ì¸ ì¡°íšŒëŠ” ë½ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.**

- ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥´ì§€ë§Œ, ë³´í†µ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” ë½ì„ íšë“í•˜ì§€ ì•Šê³  ë°”ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
    
    ì˜ˆë¥¼ ë“¤ì–´ì„œ ì„¸ì…˜1ì´ íšë“í•˜ê³  ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  ìˆì–´ë„, ì„¸ì…˜2ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒëŠ” í•  ìˆ˜ ìˆë‹¤.
    
    ë¬¼ë¡  ì„¸ì…˜2ì—ì„œ ì¡°íšŒê°€ ì•„ë‹ˆë¼ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë ¤ë©´ ë½ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ë½ì´ ëŒì•„ì˜¬ ë•Œ ê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•œë‹¤.
    

**ì¡°íšŒì™€ ë½**

- ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œë„ ë½ì„ íšë“í•˜ê³  ì‹¶ì„ ë•Œê°€ ìˆë‹¤. ì´ëŸ´ ë•ŒëŠ” `select for update` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- ì´ë ‡ê²Œ í•˜ë©´ ì„¸ì…˜1ì´ ì¡°íšŒ ì‹œì ì— ë½ì„ ê°€ì ¸ê°€ë²„ë¦¬ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.
- ë¬¼ë¡  ì´ ê²½ìš°ë„ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ë©´ ë½ì„ ë°˜ë‚©í•œë‹¤.

**ì¡°íšŒ ì‹œì ì— ë½ì´ í•„ìš”í•œ ê²½ìš°ëŠ” ì–¸ì œì¼ê¹Œ?**

- íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œì ê¹Œì§€ í•´ë‹¹ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ê³³ì—ì„œ ë³€ê²½í•˜ì§€ ëª»í•˜ë„ë¡ ê°•ì œë¡œ ë§‰ì•„ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œ `memberA`ì˜ ê¸ˆì•¡ì„ ì¡°íšŒí•œ ë‹¤ìŒì— ì´ ê¸ˆì•¡ ì •ë³´ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì–´ë–¤ ê³„ì‚°ì„ ìˆ˜í–‰í•œë‹¤. ê·¸ëŸ°ë° ì´ ê³„ì‚°ì´ ëˆê³¼ ê´€ë ¨ëœ ë§¤ìš° ì¤‘ìš”í•œ ê³„ì‚°ì´ì–´ì„œ ê³„ì‚°ì„ ì™„ë£Œí•  ë•Œ ê¹Œì§€ `memberA`ì˜ ê¸ˆì•¡ì„ ë‹¤ë¥¸ê³³ì—ì„œ ë³€ê²½í•˜ë©´ ì•ˆëœë‹¤. ì´ëŸ´ ë•Œ ì¡°íšŒ ì‹œì ì— ë½ì„ íšë“í•˜ë©´ ëœë‹¤.

![Untitled 33](https://github.com/soohyunnn/spring_db_1/assets/58289675/5a8cee96-7225-4195-8152-f850608cfb79)

ì‹¤ìŠµì„ ìœ„í•´ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì.

**ê¸°ë³¸ ë°ì´í„° ì…ë ¥ - SQL**

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
```

**ì„¸ì…˜1**

```sql
set autocommit false;
select * from member where member_id='memberA' **for update;**
```

- `select for update` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì¡°íšŒë¥¼ í•˜ë©´ì„œ ë™ì‹œì— ì„ íƒí•œ ë¡œìš°ì˜ ë½ë„ íšë“í•œë‹¤.
    - ë¬¼ë¡  ë½ì´ ì—†ë‹¤ë©´ ë½ì„ íšë“í•  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•œë‹¤.
- ì„¸ì…˜1ì€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•  ë•Œ ê¹Œì§€ `memberA`ì˜ ë¡œìš°ì˜ ë½ì„ ë³´ìœ í•œë‹¤.

**ì„¸ì…˜2**

```sql
set autocommit false;
update member set money=500 where member_id = 'memberA';
```

- ì„¸ì…˜2ëŠ” ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  ì‹¶ë‹¤. ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë ¤ë©´ ë½ì´ í•„ìš”í•˜ë‹¤.
- ì„¸ì…˜1ì´ `memberA` ë¡œìš°ì˜ ë½ì„ íšë“í–ˆê¸° ë•Œë¬¸ì— ì„¸ì…˜2ëŠ” ë½ì„ íšë“í•  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•œë‹¤.
- ì´í›„ì— ì„¸ì…˜1ì´ ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ë©´ ì„¸ì…˜2ê°€ ë½ì„ íšë“í•˜ê³  ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë‹¤. ë§Œì•½ ë½ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì´ ì§€ë‚˜ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.

**ì„¸ì…˜1 ì»¤ë°‹**

```sql
commit;
```

ì„¸ì…˜2ë„ ì»¤ë°‹í•´ì„œ ë°ì´í„°ë¥¼ ë°˜ì˜í•´ì¤€ë‹¤.

**ì„¸ì…˜2 ì»¤ë°‹**

```sql
commit;
```

**ì •ë¦¬**

- íŠ¸ëœì­ì…˜ê³¼ ë½ì€ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ì‹¤ì œ ë™ì‘í•˜ëŠ” ë°©ì‹ì´ ì¡°ê¸ˆì”© ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ ë©”ë‰´ì–¼ì„ í™•ì¸í•´ë³´ê³ , ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œ ì´í›„ì— ì‚¬ìš©í•˜ì.
- íŠ¸ëœì­ì…˜ê³¼ ë½ì— ëŒ€í•œ ë” ê¹Šì´ìˆëŠ” ë‚´ìš©ì€ JPA ì±… 16.1 íŠ¸ëœì­ì…˜ê³¼ ë½ì„ ì°¸ê³ í•˜ì.

## íŠ¸ëœì­ì…˜ - ì ìš©1

ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•´ì„œ ê³„ì¢Œì´ì²´ ê°™ì´ ì›ìì„±ì´ ì¤‘ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.

ë¨¼ì € íŠ¸ëœì­ì…˜ ì—†ì´ ë‹¨ìˆœí•˜ê²Œ ê³„ì¢Œì´ì²´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ êµ¬í˜„í•´ë³´ì.

**MemberSErviceV1**

```java
package hello.jdbc.service;

import hello.jdbc.domain.Member;
import hello.jdbc.repository.MemberRepositoryV1;
import lombok.RequiredArgsConstructor;

import java.sql.SQLException;

@RequiredArgsConstructor
public class MemberServiceV1 {

    private final MemberRepositoryV1 memberRepository;

    public void accountTransfer(String fromId, String toId, int money) throws SQLException {

        Member fromMember = memberRepository.findById(fromId);
        Member toMember = memberRepository.findById(toId);

        memberRepository.update(fromId, fromMember.getMoney() - money);
        validation(toMember);
        memberRepository.update(toId, toMember.getMoney() + money);
    }

    private void validation(Member toMember) {
        if (toMember.getMemberId().equals("ex")) {
            throw new IllegalStateException("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ");
        }
    }

}
```

- `formId`ì˜ íšŒì›ì„ ì¡°íšŒí•´ì„œ `toId`ì˜ íšŒì›ì—ì„œ `money`ë§Œí¼ì˜ ëˆì„ ê³„ì¢Œì´ì²´ í•˜ëŠ” ë¡œì§ì´ë‹¤.
    - `formId` íšŒì›ì˜ ëˆì„ `money`ë§Œí¼ ê°ì†Œí•œë‹¤. â†’ UPDATE SQL ì‹¤í–‰
    - `toId` íšŒì›ì˜ ëˆì„ `money`ë§Œí¼ ì¦ê°€í•œë‹¤. â†’ UPDATE SQL ì‹¤í–‰
- ì˜ˆì™¸ ìƒí™©ì„ í…ŒìŠ¤íŠ¸í•´ë³´ê¸° ìœ„í•´ `toId`ê°€ `â€œexâ€`ì¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒí•œë‹¤.

**MemberServiceV1Test**

```java
package hello.jdbc.service;

import hello.jdbc.connection.ConnectionConst;
import hello.jdbc.domain.Member;
import hello.jdbc.repository.MemberRepositoryV1;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import java.sql.SQLException;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatThrownBy;
import static org.junit.jupiter.api.Assertions.*;

/**
 * ê¸°ë³¸ ë™ì‘, íŠ¸ëœì­ì…˜ì´ ì—†ì–´ì„œ ë¬¸ì œ ë°œìƒ
 */
class MemberServiceV1Test {

    public static final String MEMBER_A = "memberA";
    public static final String MEMBER_B = "memberB";
    public static final String MEMBER_EX = "ex";

    private MemberRepositoryV1 memberRepository;
    private MemberServiceV1 memberService;

    @BeforeEach
    void before() {
        DriverManagerDataSource dataSource = new DriverManagerDataSource(ConnectionConst.URL, ConnectionConst.USERNAME, ConnectionConst.PASSWORD);
        memberRepository = new MemberRepositoryV1(dataSource);
        memberService = new MemberServiceV1(memberRepository);
    }

    @AfterEach
    void after() throws SQLException {
        memberRepository.delete(MEMBER_A);
        memberRepository.delete(MEMBER_B);
        memberRepository.delete(MEMBER_EX);
    }

    @Test
    @DisplayName("ì •ìƒ ì´ì²´")
    void accountTransfer() throws SQLException {
        //given
        Member memberA = new Member(MEMBER_A, 10000);
        Member memberB = new Member(MEMBER_B, 10000);
        memberRepository.save(memberA);
        memberRepository.save(memberB);

        //when
        memberService.accountTransfer(memberA.getMemberId(), memberB.getMemberId(), 2000);

        //then
        Member findMemberA = memberRepository.findById(memberA.getMemberId());
        Member findMemberB = memberRepository.findById(memberB.getMemberId());
        assertThat(findMemberA.getMoney()).isEqualTo(8000);
        assertThat(findMemberB.getMoney()).isEqualTo(12000);
    }

    @Test
    @DisplayName("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ")
    void accountTransferEx() throws  SQLException {
        //given
        Member memberA = new Member(MEMBER_A, 10000);
        Member memberEx = new Member(MEMBER_EX, 10000);
        memberRepository.save(memberA);
        memberRepository.save(memberEx);

        //when
        assertThatThrownBy(() -> memberService.accountTransfer(memberA.getMemberId(), memberEx.getMemberId(), 2000))
                .isInstanceOf(IllegalStateException.class);

        //then
        Member findMemberA = memberRepository.findById(memberA.getMemberId());
        Member findMemberEx = memberRepository.findById(memberEx.getMemberId());

        //memberAì˜ ëˆë§Œ 2000ì› ì¤„ì—ˆê³ , exì˜ ëˆì€ 10000ì› ê·¸ëŒ€ë¡œì´ë‹¤.
        assertThat(findMemberA.getMoney()).isEqualTo(8000);
        assertThat(findMemberEx.getMoney()).isEqualTo(10000);
    }

}
```

âš ï¸Â ì£¼ì˜! í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ì— ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•´ì•¼ í•œë‹¤.

```sql
delete from member;
```

**ì •ìƒì´ì²´ - accountTransfer()**

- given : ë‹¤ìŒ ë°ì´í„°ë¥¼ ì €ì¥í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì¤€ë¹„í•œë‹¤.
    - `memberA` 10000ì›
    - `memberB` 10000ì›
- when : ê³„ì¢Œì´ì²´ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.
    - `memberService.accountTransfer()`ë¥¼ ì‹¤í–‰í•œë‹¤.
    - `memberA` â†’ `memberB`ë¡œ 2000ì› ê³„ì¢Œì´ì²´ í•œë‹¤.
        - `memberA`ì˜ ê¸ˆì•¡ì´ 2000ì› ê°ì†Œí•œë‹¤.
        - `memberB`ì˜ ê¸ˆì•¡ì´ 2000ì› ì¦ê°€í•œë‹¤.
- then : ê³„ì¢Œì´ì²´ê°€ ì •ìƒ ìˆ˜í–‰ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.
    - `memberA` 8000ì› - 2000ì› ê°ì†Œ
    - `memberB` 12000ì› - 2000ì› ì¦ê°€

ğŸ‘‰Â ì •ìƒì´ì²´ ë¡œì§ì´ ì •ìƒ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**í…ŒìŠ¤íŠ¸ ë°ì´í„° ì œê±°**

í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ `@AfterEach`ì—ì„œ í…ŒìŠ¤íŠ¸ì— ìƒìš”í•œ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•œë‹¤.

- `@BeforeEach` : ê°ê°ì˜ í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ë˜ê¸° ì „ì— ì‹¤í–‰ëœë‹¤.
- `@AfterEach` : ê°ê°ì˜ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê³  ë‚œ ì´í›„ì— ì‹¤í–‰ëœë‹¤.

```java
@AfterEach
void after() throws SQLException {
    memberRepository.delete(MEMBER_A);
    memberRepository.delete(MEMBER_B);
    memberRepository.delete(MEMBER_EX);
}
```

- í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì œê±°í•˜ëŠ” ê³¼ì •ì´ ë¶ˆí¸í•˜ì§€ë§Œ, ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë ¤ë©´ í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•œ ë°ì´í„°ë¥¼ ëª¨ë‘ ì œê±°í•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì´ë²ˆ í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•œ ë°ì´í„° ë•Œë¬¸ì— ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì—ì„œ ë°ì´í„° ì¤‘ë³µìœ¼ë¡œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•œ ë°ì´í„°ë¥¼ ì œê±°í•˜ëŠ” ë” ë‚˜ì€ ë°©ë²•ìœ¼ë¡œëŠ” íŠ¸ëœì­ì…˜ì„ í™œìš©í•˜ë©´ ëœë‹¤. í…ŒìŠ¤íŠ¸ ì „ì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ ì´í›„ì— íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•´ë²„ë¦¬ë©´ ë°ì´í„°ê°€ ì²˜ìŒ ìƒíƒœë¡œ ëŒì•„ì˜¨ë‹¤. ì´ ë°©ë²•ì€ ì´í›„ì— ì„¤ëª…í•˜ê² ë‹¤.

**ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ - accountTransferEx()**

- given : ë‹¤ìŒ ë°ì´í„°ë¥¼ ì €ì¥í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì¤€ë¹„í•œë‹¤.
    - `memberA` 10000ì›
    - `memberEx` 10000ì›
- when : ê³„ì¢Œì´ì²´ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.
    - `memberService.accountTransfer()`ì„ ì‹¤í–‰í•œë‹¤.
    - `memberA` â†’ `memberEx`ë¡œ 2000ì› ê³„ì¢Œì´ì²´ í•œë‹¤.
        - `memberA`ì˜ ê¸ˆì•¡ì´ 2000ì› ê°ì†Œí•œë‹¤.
        - `memberEx`íšŒì›ì˜ IDëŠ” `ex`ì´ë¯€ë¡œ ì¤‘ê°„ì— ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ â†’ ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•˜ë‹¤.
- then : ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í•œë‹¤. memberAì˜ ëˆë§Œ 2000ì› ì¤„ì–´ë“ ë‹¤.
    - `memberA` 8000ì› - 2000ì› ê°ì†Œ
    - `memberB` 10000ì› - ì¤‘ê°„ì— ì‹¤íŒ¨ë¡œ ë¡œì§ì´ ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ë‹¤. ë”°ë¼ì„œ ê·¸ëŒ€ë¡œ 10000ì›ìœ¼ë¡œ ë‚¨ì•„ìˆê²Œ ëœë‹¤.

**ì •ë¦¬**

ì´ì²´ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ê²Œ ë˜ë©´ `memberA`ì˜ ê¸ˆì•¡ì€ 10000ì› â†’ 8000ì›ìœ¼ë¡œ 2000ì› ê°ì†Œí•œë‹¤. ê·¸ëŸ°ë° `memberB`ì˜ ëˆì€ ê·¸ëŒ€ë¡œ 10000ì›ìœ¼ë¡œ ë‚¨ì•„ìˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ `memberA`ì˜ ëˆë§Œ 2000ì› ê°ì†Œí•œ ê²ƒì´ë‹¤.

## íŠ¸ëœì­ì…˜ - ì ìš©2

- ì´ë²ˆì—ëŠ” DB íŠ¸ëœì­ì…˜ì„ ìƒìš”í•´ì„œ ì•ì—ì„œ ë°œìƒí•œ ë¬¸ì œì ì„ í•´ê²°í•´ë³´ì.
- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì–´ë–¤ ê³„ì¸µì— ê±¸ì–´ì•¼ í• ê¹Œ? ì¦‰, íŠ¸ëœì­ì…˜ì„ ì–´ë””ì—ì„œ ì‹œì‘í•˜ê³ , ì–´ë””ì—ì„œ ì»¤ë°‹í•´ì•¼í• ê¹Œ?

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ íŠ¸ëœì­ì…˜**

![Untitled 34](https://github.com/soohyunnn/spring_db_1/assets/58289675/2af3b244-f9eb-4197-b45b-8fea33515f7d)

- íŠ¸ëœì­ì…˜ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì‹œì‘í•´ì•¼ í•œë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì˜ëª»ë˜ë©´ í•´ë‹¹
    
    ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œ ì¸í•´ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì„ í•¨ê»˜ ë¡¤ë°±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
    
- ê·¸ëŸ°ë° íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì»¤ë„¥ì…˜ì´ í•„ìš”í•˜ë‹¤. ê²°êµ­ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì»¤ë„¥ì…˜ì„ ë§Œë“¤ê³ , íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ì— ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•´ì•¼ í•œë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë™ì•ˆ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•´ì•¼í•œë‹¤.
    
    ê·¸ë˜ì•¼ ê°™ì€ ì„¸ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    

**ì»¤ë„¥ì…˜ê³¼ ì„¸ì…˜**

![Untitled 35](https://github.com/soohyunnn/spring_db_1/assets/58289675/597941d1-146f-4042-af90-c1b7d38668a7)

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ê°€ì¥ ë‹¨ìˆœí•œ ë°©ë²•ì€ ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì„œ ê°™ì€ ì»¤ë„¥ì…˜ì´ ì‚¬ìš©ë˜ë„ë¡ ìœ ì§€í•˜ëŠ” ê²ƒì´ë‹¤.

ë¨¼ì € ë¦¬í¬ì§€í† ë¦¬ê°€ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ì.

**MemberRepositoryV2**

```java
package hello.jdbc.repository;

import hello.jdbc.domain.Member;
import lombok.extern.slf4j.Slf4j;
import org.springframework.jdbc.support.JdbcUtils;

import javax.sql.DataSource;
import java.sql.*;
import java.util.NoSuchElementException;

/**
 * JDBC - ConnectionParam
 */
@Slf4j
public class MemberRepositoryV2 {

    private final DataSource dataSource;

    public MemberRepositoryV2(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public Member save(Member member) throws SQLException {

        String sql = "insert into member(member_id, money) values(?, ?)";

        Connection con = null;
        PreparedStatement pstmt = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, member.getMemberId());
            pstmt.setInt(2, member.getMoney());
            pstmt.executeUpdate();
            return member;
        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
            close(con, pstmt, null);
        }

    }

    public Member findById(Connection con, String memberId) throws SQLException {
        String sql = "select * from member where member_id = ?";

        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, memberId);

            rs = pstmt.executeQuery();

            if (rs.next()) {
                Member member = new Member();
                member.setMemberId(rs.getString("member_id"));
                member.setMoney(rs.getInt("money"));
                return member;
            } else {
                throw new NoSuchElementException("member not found memberId=" + memberId);
            }
        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
						//connectionì€ ì—¬ê¸°ì„œ ë‹«ì§€ X
            JdbcUtils.closeResultSet(rs);
		        JdbcUtils.closeStatement(stmt);
        }

    }

    public void update(Connection con, String memberId, int money) throws SQLException {
        String sql = "update member set money = ? where member_id = ?";

        PreparedStatement pstmt = null;

        try {
            pstmt = con.prepareStatement(sql);
            pstmt.setInt(1, money);
            pstmt.setString(2, memberId);
            int resultSize = pstmt.executeUpdate();
            log.info("resultSize={}", resultSize);
        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
						//connectionì€ ì—¬ê¸°ì„œ ë‹«ì§€ X
            JdbcUtils.closeStatement(pstmt);
        }

    }

    public void delete(String memberId) throws SQLException {
        String sql = "delete from member where member_id = ?";

        Connection con = null;
        PreparedStatement pstmt = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, memberId);

            pstmt.executeUpdate();

        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
            close(con, pstmt, null);
        }
    }

    private void close(Connection con, Statement stmt, ResultSet rs) {
        JdbcUtils.closeResultSet(rs);
        JdbcUtils.closeStatement(stmt);
        JdbcUtils.closeConnection(con);
    }

    private Connection getConnection() throws SQLException {
        Connection con = dataSource.getConnection();
        log.info("get connection={}, class={}", con, con.getClass());
        return con;
    }

}
```

`MemberRepositoryV2`ëŠ” ê¸°ì¡´ ì½”ë“œì™€ ê°™ì€ ì»¤ë„¥ì…˜ ìœ ì§€ê°€ í•„ìš”í•œ ë‹¤ìŒ ë‘ ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆë‹¤. ì°¸ê³ ë¡œ ë‹¤ìŒ ë‘ ë©”ì„œë“œëŠ” ê³„ì¢Œì´ì²´ ì„œë¹„ìŠ¤ ë¡œì§ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œì´ë‹¤.

- `findById(Connection con, String memberId)`
- `update(Connection con, String memberId, int money)`

âš ï¸Â ì£¼ì˜ - ì½”ë“œì—ì„œ ë‹¤ìŒ ë¶€ë¶„ì„ ì£¼ì˜í•´ì„œ ë³´ì!

1. ì»¤ë„¥ì…˜ ìœ ì§€ê°€ í•„ìš”í•œ ë‘ ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ con = getConnection() ì½”ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
2. ì»¤ë„¥ì…˜ ìœ ì§€ê°€ í•„ìš”í•œ ë‘ ë©”ì„œë“œëŠ” ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì»¤ë„¥ì…˜ì„ ë‹«ìœ¼ë©´ ì•ˆëœë‹¤. ì»¤ë„¥ì…˜ì„ ì „ë‹¬ ë°›ì€ ë¦¬í¬ì§€í† ë¦¬ ë¿ë§Œ ì•„ë‹ˆë¼ ì´í›„ì—ë„ ì»¤ë„¥ì…˜ì„ ê³„ì† ì´ì–´ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì´í›„ ì„œë¹„ìŠ¤ ë¡œì§ì´ ëë‚  ë•Œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•˜ê³  ë‹«ì•„ì•¼ í•œë‹¤.

ì´ì œ ê°€ì¥ ì¤‘ìš”í•œ íŠ¸ëœì­ì…˜ ì—°ë™ ë¡œì§ì„ ì‘ì„±í•´ë³´ì.

**MemberServiceV2**

```java
package hello.jdbc.service;

import hello.jdbc.domain.Member;
import hello.jdbc.repository.MemberRepositoryV2;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.SQLException;

/**
 *
 */
@Slf4j
@RequiredArgsConstructor
public class MemberServiceV2 {

    private final DataSource dataSource;
    private final MemberRepositoryV2 memberRepository;

    public void accountTransfer(String fromId, String toId, int money) throws SQLException {
        Connection con = dataSource.getConnection();
        try {
            con.setAutoCommit(false);  //íŠ¸ëœì­ì…˜ ì‹œì‘
            //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
            bizLogic(con, fromId, toId, money);
            con.commit();  //ì„±ê³µì‹œ ì»¤ë°‹
        } catch (Exception e) {
            con.rollback();  //ì‹¤íŒ¨ì‹œ ë¡ë°±
            throw new IllegalStateException(e);
        } finally {
            release(con);
        }     
    }

    private void bizLogic(Connection con, String fromId, String toId, int money) throws  SQLException {
        Member fromMember = memberRepository.findById(con, fromId);
        Member toMember = memberRepository.findById(con, toId);

        memberRepository.update(con, fromId, fromMember.getMoney() - money);
        validation(toMember);
        memberRepository.update(con, toId, toMember.getMoney() + money);

    }

    private void validation(Member toMember) {
        if (toMember.getMemberId().equals("ex")) {
            throw new IllegalStateException("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ");
        }
    }

    private void release(Connection con) {
        if (con != null) {
            try {
                con.setAutoCommit(true);  //ì»¤ë„¥ì…˜ í’€ ê³ ë ¤
                con.close();
            } catch (Exception e) {
                log.info("error", e);
            }
        }
    }

}
```

- `Connection con = dataSource.getConnection();`
    - íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì»¤ë„¥ì…˜ì´ í•„ìš”í•˜ë‹¤.
- `con.setAutoCommit(false);  //íŠ¸ëœì­ì…˜ ì‹œì‘`
    - íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ìë™ ì»¤ë°‹ ëª¨ë“œë¥¼ êº¼ì•¼í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì»¤ë„¥ì…˜ì„ í†µí•´ ì„¸ì…˜ì— `set autocommit false`ê°€ ì „ë‹¬ë˜ê³ , ì´í›„ë¶€í„°ëŠ” ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë™ì‘í•œë‹¤. ì´ë ‡ê²Œ ìë™ ì»¤ë°‹ ëª¨ë“œë¥¼ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  ë³´í†µ í‘œí˜„í•œë‹¤.
- `bizLogic(con, fromId, toId, money);`
    - íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•˜ë©´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.
    - ì´ë ‡ê²Œ ë¶„ë¦¬í•œ ì´ìœ ëŠ” íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë¡œì§ê³¼ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•¨ì´ë‹¤.
    - `memberRepository.update(con..)` : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë³´ë©´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ í˜¸ì¶œí•  ë•Œ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- `con.commit();  //ì„±ê³µì‹œ ì»¤ë°‹`
    - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì •ìƒ ìˆ˜í–‰ë˜ë©´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.
- `con.rollback()   //ì‹¤íŒ¨ì‹œ ë¡¤ë°±`
    - `catch(Ex){â€¦}`ë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ ë„ì¤‘ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.
- `release(con);`
    - `finally {â€¦}`ë¥¼ ì‚¬ìš©í•´ì„œ ì»¤ë„¥ì…˜ì„ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ë‚˜ë©´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•œë‹¤. ê·¸ëŸ°ë° ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ë©´ `con.close()`ë¥¼ í˜¸ì¶œ í–ˆì„ ë•Œ ì»¤ë„¥ì…˜ì´ ì¢…ë£Œë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í’€ì— ë°˜ë‚©ëœë‹¤. í˜„ì¬ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— í’€ì— ëŒë ¤ì£¼ê¸° ì „ì— ê¸°ë³¸ ê°’ì´ ìë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.

**MemberServiceV2Test**

```java
package hello.jdbc.service;

import hello.jdbc.connection.ConnectionConst;
import hello.jdbc.domain.Member;
import hello.jdbc.repository.MemberRepositoryV2;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import java.sql.SQLException;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatThrownBy;
import static org.junit.jupiter.api.Assertions.*;

/**
 * íŠ¸ëœì­ì…˜ - ì»¤ë„¥ì…˜ íŒŒë¼ë¯¸í„° ì „ë‹¬ ë°©ì‹ ë™ê¸°í™”
 */
class MemberServiceV2Test {

    private MemberRepositoryV2 memberRepository;
    private MemberServiceV2 memberService;

    @BeforeEach
    void before() {
        DriverManagerDataSource dataSource = new DriverManagerDataSource(ConnectionConst.URL, ConnectionConst.USERNAME, ConnectionConst.PASSWORD);
        memberRepository = new MemberRepositoryV2(dataSource);
        memberService = new MemberServiceV2(dataSource, memberRepository);
    }

    @AfterEach
    void after() throws SQLException {
        memberRepository.delete("memberA");
        memberRepository.delete("memberB");
        memberRepository.delete("ex");
    }

    @Test
    @DisplayName("ì •ìƒ ì´ì²´")
    void accountTransfer() throws SQLException {
        //given
        Member memberA = new Member("memberA", 10000);
        Member memberB = new Member("memberB", 10000);
        memberRepository.save(memberA);
        memberRepository.save(memberB);

        //when
        memberService.accountTransfer(memberA.getMemberId(), memberB.getMemberId(), 2000);

        //then
        Member findMemberA = memberRepository.findById(memberA.getMemberId());
        Member findMemberB = memberRepository.findById(memberB.getMemberId());
        assertThat(findMemberA.getMoney()).isEqualTo(8000);
        assertThat(findMemberB.getMoney()).isEqualTo(12000);
    }

    @Test
    @DisplayName("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ")
    void accountTransferEx() throws SQLException {
        //given
        Member memberA = new Member("memberA", 10000);
        Member memberEx = new Member("memberB", 10000);
        memberRepository.save(memberA);
        memberRepository.save(memberEx);

        //when
        assertThatThrownBy(() -> memberService.accountTransfer(memberA.getMemberId(), memberEx.getMemberId(), 2000))
                .isInstanceOf(IllegalStateException.class);

        //then
        Member findMemberA = memberRepository.findById(memberA.getMemberId());
        Member findMemberEx = memberRepository.findById(memberEx.getMemberId());

        //memberAì˜ ëˆì´ ë¡¤ë°± ë˜ì–´ì•¼í•¨
        assertThat(findMemberA.getMoney()).isEqualTo(10000);
        assertThat(findMemberEx.getMoney()).isEqualTo(10000);
    }

}
```

**ì •ìƒì´ì²´ - accountTransfer()**

ê¸°ì¡´ ë¡œì§ê³¼ ê°™ì•„ì„œ ìƒëµí•œë‹¤.

**ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ - accountTransferEx()**

- ë‹¤ìŒ ë°ì´í„°ë¥¼ ì €ì¥í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì¤€ë¹„í•œë‹¤.
    - `memberA` 10000ì›
    - `memberEx` 10000ì›
- ê³„ì¢Œì´ì²´ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.
    - `memberService.accountTransfer()`ë¥¼ ì‹¤í–‰í•œë‹¤.
    - ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ê³  íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.
    - `memberA` â†’ `memberEx`ë¡œ 2000ì› ê³„ì¢Œì´ì²´ í•œë‹¤.
        - `memberA`ì˜ ê¸ˆì•¡ì´ 2000ì› ê°ì†Œí•œë‹¤.
        - `memberEx`íšŒì›ì˜ IDëŠ” `ex`ì´ë¯€ë¡œ ì¤‘ê°„ì— ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
    - ì˜ˆì™¸ê°€ ë°œìƒí–ˆìœ¼ë¯€ë¡œ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•œë‹¤.
- ê³„ì¢Œì´ì²´ëŠ” ì‹¤íŒ¨í–ˆë‹¤. ë¡¤ë°±ì„ ìˆ˜í–‰í•´ì„œ `memberA`ì˜ ëˆì´ ê¸°ì¡´ 10000ì›ìœ¼ë¡œ ë³µêµ¬ë˜ì—ˆë‹¤.
    - `memberA` 10000ì› - íŠ¸ëœì­ì…˜ ë¡¤ë°±ìœ¼ë¡œ ë³µêµ¬ëœë‹¤.
    - `memberB` 10000ì› - ì¤‘ê°„ì— ì‹¤íŒ¨ë¡œ ë¡œì§ì´ ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ë‹¤. ë”°ë¼ì„œ ê·¸ëŒ€ë¡œ 10000ì›ìœ¼ë¡œ ë‚¨ì•„ìˆê²Œ ëœë‹¤.

íŠ¸ëœì­ì…˜ ë•ë¶„ì— ê³„ì¢Œì´ì²´ê°€ ì‹¤íŒ¨í•  ë•Œ ë¡¤ë°±ì„ ìˆ˜í–‰í•´ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ì´ˆê¸°í™” í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ê³„ì¢Œì´ì²´ë¥¼ ìˆ˜í–‰í•˜ê¸° ì§ì „ìœ¼ë¡œ ëŒì•„ê°€ê²Œ ëœë‹¤.

**â£ï¸Â ë‚¨ì€ ë¬¸ì œ**

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB íŠ¸ëœì­ì…˜ì„ ì ìš©í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ ê³„ì¸µì´ ë§¤ìš° ì§€ì €ë¶„í•´ì§€ê³ , ìƒê°ë³´ë‹¤ ë§¤ìš° ë³µì¡í•œ ì½”ë“œë¥¼ ìš”êµ¬í•œë‹¤. ì¶”ê°€ë¡œ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•˜ë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒë„ ì‰¬ìš´ ì¼ì€ ì•„ë‹ˆë‹¤. ë‹¤ìŒ ì‹œê°„ì—ëŠ” ìŠ¤í”„ë§ì„ ì‚¬ìš©í•´ì„œ ì´ëŸ° ë¬¸ì œë“¤ì„ í•˜ë‚˜ì”© í•´ê²°í•´ë³´ì.